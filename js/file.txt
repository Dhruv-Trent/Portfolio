const cvs = document.getElementById("codeRain");
const ctxx = cvs.getContext("2d");

cvs.height = window.innerHeight;
cvs.width = window.innerWidth;

const letters = "アァカサタナハマヤャラワ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ";
const fontSize = 16;
const columns = cvs.width / fontSize;

const drops = Array(Math.floor(columns)).fill(1);

// Start animation
let startTime = Date.now();
let animationDuration = 5000; // 5 seconds

function draw() {
  ctxx.fillStyle = "rgba(0, 0, 0, 0.05)";
  ctxx.fillRect(0, 0, cvs.width, cvs.height);

  ctxx.fillStyle = "#0F0";
  ctxx.font = fontSize + "px monospace";

  for (let i = 0; i < drops.length; i++) {
    const text = letters.charAt(Math.floor(Math.random() * letters.length));
    ctxx.fillText(text, i * fontSize, drops[i] * fontSize);

    if (drops[i] * fontSize > cvs.height && Math.random() > 0.975) {
      drops[i] = 0;
    }
    drops[i]++;
  }

  // Check if time is up -> morph to name
  if (Date.now() - startTime > animationDuration - 2000) {
    ctxx.fillStyle = "#0F0";
    ctxx.font = "bold 50px monospace";
    const text = "DHRUV PATEL";
    const textWidth = ctxx.measureText(text).width;
    ctxx.fillText(text, cvs.width / 2 - textWidth / 2, cvs.height / 2);
  }

  if (Date.now() - startTime < animationDuration) {
    requestAnimationFrame(draw);
  } else {
    document.querySelector(".loading").style.display = "none";
    document.querySelector(".afterLoading").style.display = "block";
  }
}

draw();